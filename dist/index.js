!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(self,(()=>(()=>{"use strict";var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>y});const r=require("react");var n=t.n(r);const o=require("classnames");var i=t.n(o);const c=({register:t,directionStep:e,shiftDirectionStep:n,keyDownDirectionHandel:o})=>{const i=({direction:t,step:e,altKey:r,curPosition:n})=>{let o=n.left,i=n.right,c=n.top,l=n.bottom;return"left"===t?(r||(o-=e),i+=e):"top"===t?(r||(c-=e),l+=e):"right"===t?r?i-=e:(i-=e,o+=e):"bottom"===t&&(r?l-=e:(l-=e,c+=e)),{top:c,left:o,right:i,bottom:l}},c=t=>{const r=t.keyCode||t.which||t.charCode;if(![37,38,39,40].includes(r))return;const c=t.shiftKey,l=t.altKey;let a=e,s=null;c&&(a=n),37===r?(s="left",t.preventDefault()):38===r?(s="top",t.preventDefault()):39===r?(s="right",t.preventDefault()):40===r&&(s="bottom",t.preventDefault()),o&&o({direction:s,step:a,altKey:l,getNewPosition:i})};(0,r.useEffect)((()=>{if(t)return console.log("我从新绑定了"),document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}}),[e,n,o])},l=require("prop-types");var a=t.n(l);const s=(0,r.createContext)(),u=(0,r.memo)((t=>{const e=(0,r.useRef)({Items:{}});return(0,r.useEffect)((()=>{if(null!==t.defaultActive){const r=Object.values(e.current.Items);for(let e=0;e<r.length;e++){const n=r[e];if(n.comid===t.defaultActive)return void n.setActive(!0)}}}),[]),c({register:null!==t.keyDirection,directionStep:t.directionStep,shiftDirectionStep:t.shiftDirectionStep,keyDownDirectionHandel:({direction:r,step:n,altKey:o,getNewPosition:i})=>{const c=Object.values(e.current.Items);for(let e=0;e<c.length;e++){const l=c[e];let a=null;if("boolean"==typeof t.keyDirection&&!0===t.keyDirection&&(a=!0===l.activeSync.current),"string"==typeof t.keyDirection&&(a=l.comid===t.keyDirection),a){const{top:t,left:e,right:c,bottom:a}=l.getCurPosition(),{top:s,left:u,right:m,bottom:p}=i({direction:r,step:n,altKey:o,curPosition:{top:t,left:e,right:c,bottom:a}});return void l.setPosition({top:s,left:u,right:m,bottom:p})}}}}),n().createElement(s.Provider,{value:{getDragResizeContext:t=>e.current.Items[t],getTotalDragResizeContext:()=>e.current.Items,registerDragResize:(t,r)=>{if(t){const{Items:n}={...e.current};n[t]=r,e.current={...e.current,Items:n}}},unregisterDragResize:t=>{const{Items:r}={...e.current};delete r[t],e.current={...e.current,Items:r}}}},t?.children||"")}));u.propTypes={defaultActive:a().string,keyDirection:(0,l.oneOfType)([a().string,a().bool,a().array]),directionStep:a().number,shiftDirectionStep:a().number},u.defaultProps={defaultActive:null,keyDirection:null,directionStep:1,shiftDirectionStep:10};const m=u,p=require("styled-components"),f=t.n(p)().div`
  &.rdr {
    position: absolute;
    box-sizing: border-box;
    &.active:before {
      content: '';
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      box-sizing: border-box;
      outline: 1px dashed #d6d6d6;
    }
    &.inactive .rdr-stick {
      display: none;
    }
  }
  .rdr-stick {
    box-sizing: border-box;
    position: absolute;
    font-size: 1px;
    background: #ffffff;
    border: 1px solid #6c6c6c;
    box-shadow: 0 0 2px #bbb;
  }
  .rdr-stick-tl,
  .rdr-stick-br {
    cursor: nwse-resize;
  }
  .rdr-stick-tm,
  .rdr-stick-bm {
    left: 50%;
    cursor: ns-resize;
  }
  .rdr-stick-tr,
  .rdr-stick-bl {
    cursor: nesw-resize;
  }
  .rdr-stick-ml,
  .rdr-stick-mr {
    top: 50%;
    cursor: ew-resize;
  }
  .rdr-stick.not-resizable {
    display: none;
  }
  .content-container {
    display: block;
    position: relative;
  }
`,d=(t,e=!0)=>{let n=null,o=null;const i=(0,r.useRef)(t);if(e){const[e,i]=(0,r.useState)(t);n=e,o=i}return[n,t=>{e&&o(t),i.current=t},i]},g=(t,e,n={immediate:!1})=>{const o=(0,r.useRef)(),i=(0,r.useRef)(!1);(0,r.useEffect)((()=>{i.current?e(t,o.current):(i.current=!0,n.immediate&&e(t,o.current)),o.current=t}),[t])},h={t:"top",m:"marginTop",b:"bottom"},b={l:"left",m:"marginLeft",r:"right"},x=(0,r.memo)((0,r.forwardRef)(((t,e)=>{const o=(0,r.useRef)(),l=(0,r.useRef)(),[,,a]=d(Math.random().toString(36).substr(3,10)),[,u,m]=d(!1,!1),[,p,x]=d(!1,!1),[,y,v]=d({pointerX:0,pointerY:0,left:0,right:0,top:0,bottom:0,width:0,heihgt:0},!1),[w,S]=(0,r.useState)(1),[D,k]=(0,r.useState)({left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}}),[M,R]=d(null),[,z,C]=d(null,!1),[X,Y,E]=d(null),[T,P]=(0,r.useState)(null),[L,A,H]=d(null),[B,N,O]=d(null),[I,j,K]=d(null),[W,q,$]=d(null),[G,_,F]=d(null),[J,Q,U]=d(null),{recordHistorySteps:V,recordCurrentSteps:Z,getHistorySteps:tt,historyStepsSync:et,setCurStep:rt,curStepSync:nt}=(t=>{const[,,e]=d([],!1),[,r,n]=d(0,!1),[,o,i]=d(null,!1);return{recordHistorySteps:({dimensionsBeforeMoveData:o})=>{if(n.current<0){const t=e.current.length+n.current;e.current.splice(t),r(0)}t>0&&(e.current.length===t&&e.current.splice(0,1),e.current.push(o))},recordCurrentSteps:t=>{o(t)},getHistorySteps:t=>{if(0===t)return i.current;const r=e.current.length+t;return r>-1?e.current[r]:null},setCurStep:r,curStepSync:n,historyStepsSync:e}})(t.historyStepsLength),ot=({top:e,left:r,right:n,bottom:o})=>{O.current-o-e<=1||H.current-n-r<=1||!0===t.parentLimitation&&(e<0||r<0||n<0||o<0)||(q(e),j(r),_(n),Q(o))},it=t=>{const e=tt(t);return null!==e?(ot({top:e.top,left:e.left,right:e.right,bottom:e.bottom}),rt(t),{status:"success"}):{status:"last"}};(0,r.useImperativeHandle)(e,(()=>({previousOperationStep(){const t=nt.current-1;return it(t)},nextOperationStep(){if(0===nt.current)return{status:"first"};const t=nt.current+1;return it(t)},goOperationStep:t=>it(t),historySteps:et})));const{conflictCheck:ct}=(({isConflictCheck:t,rootRef:e})=>{function n(t){let e=t.replace(/[^0-9\-,]/g,"");return void 0===e&&(e=0),parseFloat(e)}return(0,r.useEffect)((()=>{e.current.setAttribute("data-is-check",`${t}`)}),[]),{conflictCheck:({top:r,left:o,width:i,height:c})=>{if(t){const t=e.current.parentNode.childNodes;for(let e=0;e<t.length;e++){const l=t[e];if(void 0!==l.className&&!l.className.includes("Operation")&&null!==l.getAttribute("data-is-check")&&"false"!==l.getAttribute("data-is-check")){const t=l.offsetWidth,e=l.offsetHeight,a=n(l.style.left),s=n(l.style.top),u=o<=a&&r>=s&&o+i>a&&r<s+e||r<s&&o>a&&r+c>s&&o<a+t,m=r<=s&&o>=a&&r+c>s&&o<a+t||r>=s&&o<=a&&r<s+e&&o>a+t,p=r<=s&&o>=a&&r+c>s&&o<a+t||r>=s&&o<=a&&r<s+e&&o>a+t,f=o>=a&&r>=s&&o<a+t&&r<s+e||r>s&&o<=a&&o+i>a&&r<s+e,d=r<=s&&o>=a&&r+c>s&&o<a+t||r>=s&&o<=a&&r<s+e&&o+i>a;return r>=s&&o>=a&&s+e>r&&a+t>o||r<=s&&o<a&&r+c>s&&o+i>a||u||m||p||f||d?{type:"on",isConflict:!0}:{type:"on",isConflict:!1}}}return{type:"on",isConflict:!1}}return{type:"off"}}}})({isConflictCheck:t.isConflictCheck,rootRef:l}),lt=(0,r.useContext)(s);c({register:!lt&&!(null===t.keyDirection||!1===t.keyDirection),directionStep:t.directionStep,shiftDirectionStep:t.shiftDirectionStep,keyDownDirectionHandel:({direction:t,step:e,altKey:r,getNewPosition:n})=>{if(!0===E.current){const{top:o,left:i,right:c,bottom:l}=n({direction:t,step:e,altKey:r,curPosition:{top:$.current,left:K.current,right:F.current,bottom:U.current}});ot({top:o,left:i,right:c,bottom:l})}}}),g(t.w,((t,e)=>{if(m.current||x.current||t===ut)return;const r=e-t;gt("mr",{pageX:G,pageY:W+mt/2},!0),xt({x:r,y:0}),Dt()})),g(t.h,((t,e)=>{if(m.current||x.current||t===mt)return;const r=e-t;gt("bm",{pageX:I+ut/2,pageY:J},!0),xt({x:0,y:r}),Dt()})),g(t.y,((t,e)=>{if(m.current||x.current||t===W)return;const r=e-t;ht({pageX:I,pageY:W}),yt({x:0,y:r}),kt()})),g(t.x,((t,e)=>{if(m.current||x.current||t===I)return;const r=e-t;ht({pageX:I,pageY:W}),yt({x:r,y:0}),kt()})),g(t.z,(t=>{(t>=0||"auto"===t)&&P(t)}),{immediate:!0}),g(t.isActive,(t=>{lt||Y(t)}),{immediate:!0}),g(t.parentW,(t=>{_(t-ut-I),A(t)})),g(t.parentH,(t=>{Q(t-mt-W),N(t)})),(0,r.useEffect)((()=>{const e=l.current.parentNode,r=t.parentW?t.parentW:e.clientWidth,n=t.parentH?t.parentH:e.clientHeight,o=t.x,i=t.y;A(r),N(n),j(o),q(i),_(r-("auto"===t.w?e.scrollWidth:t.w)-o),Q(n-("auto"===t.h?e.scrollHeight:t.h)-i),t.dragHandle&&[...e.querySelectorAll(t.dragHandle)].forEach((t=>{t.setAttribute("data-drag-handle",a)})),t.dragCancel&&[...e.querySelectorAll(t.dragCancel)].forEach((t=>{t.setAttribute("data-drag-cancel",a)}))}),[]),(0,r.useEffect)((()=>(lt?.registerDragResize(a.current,{setActive:Y,activeSync:E,comid:t.comid,getCurPosition:()=>({left:K.current,right:F.current,top:$.current,bottom:U.current}),setPosition:ot}),()=>{lt?.unregisterDragResize(a.current)})),[]),(0,r.useEffect)((()=>{const t=new Map([["mousemove",bt],["mouseup",St],["mouseleave",St],["mousedown",ft],["touchmove",bt],["touchend",St],["touchcancel",St],["touchstart",St]]);return t.forEach(((t,e)=>{document.documentElement.addEventListener(e,t)})),()=>{t.forEach(((t,e)=>{document.documentElement.removeEventListener(e,t)}))}}),[bt,St,ft]);const at=(0,r.useCallback)((e=>{const{stickSize:r,parentScaleX:n,parentScaleY:o}=t,i={width:r/n+"px",height:r/o+"px"};return i[h[e[0]]]=r/n/-2+"px",i[b[e[1]]]=r/n/-2+"px",i}),[t.stickSize,t.parentScaleX,t.parentScaleY]),st=(0,r.useMemo)((()=>({top:`${W}px`,left:`${I}px`,zIndex:T})),[W,I,T]),ut=(0,r.useMemo)((()=>L-I-G),[L,I,G]),mt=(0,r.useMemo)((()=>B-W-J),[L,W,J]),pt=(0,r.useMemo)((()=>({width:"auto"===t.w.toString()?"auto":`${ut}px`,height:"auto"===t.h.toString()?"auto":`${mt}px`})),[t.w,t.h,ut,mt]);function ft(e){t.onDeselect&&t.onDeselect({comid:t.comid,ev:e}),dt(!1)}function dt(e){void 0===t.isActive&&Y(e)}function gt(e,r,n=!1){r.stopPropagation&&r.stopPropagation(),r.preventDefault&&r.preventDefault(),(t.isResizable&&E.current||n)&&(u(!0),R(!0),Mt({pointerX:void 0!==r.pageX?r.pageX:r.touches[0].pageX,pointerY:void 0!==r.pageY?r.pageY:r.touches[0].pageY}),z(e),k(function(){let e=t.minh,r=t.minw,n=t.maxh,o=t.maxw;t.aspectRatio&&(r/e>w?e=r/w:r=w*e,null!==o?null===n?n=o*w:o/n>w?o=n/w:n=o*w:null!==n&&(o=n/w));let i=null,c=null,l=null,a=null;null!==o&&(i=I-(o-ut),c=G-(o-ut)),null!==n&&(l=W-(n-mt),a=J-(n-mt)),t.parentLimitation&&(i=i<0?0:i,c=c<0?0:c,l=l<0?0:l,a=a<0?0:a);const s={left:{min:i,max:I+(ut-r)},right:{min:c,max:G+(ut-r)},top:{min:l,max:W+(mt-e)},bottom:{min:a,max:J+(mt-e)}};if(t.aspectRatio){const t={left:{min:I-Math.min(W,J)*w*2,max:I+(mt-e)/2*w*2},right:{min:G-Math.min(W,J)*w*2,max:G+(mt-e)/2*w*2},top:{min:W-Math.min(I,G)/w*2,max:W+(ut-r)/2/w*2},bottom:{min:J-Math.min(I,G)/w*2,max:J+(ut-r)/2/w*2}};"m"===C.current[0]?(s.left={min:Math.max(s.left.min,t.left.min),max:Math.min(s.left.max,t.left.max)},s.right={min:Math.max(s.right.min,t.right.min),max:Math.min(s.right.max,t.right.max)}):"m"===C.current[1]&&(s.top={min:Math.max(s.top.min,t.top.min),max:Math.min(s.top.max,t.top.max)},s.bottom={min:Math.max(s.bottom.min,t.bottom.min),max:Math.min(s.bottom.max,t.bottom.max)})}return s}()))}function ht(e){const{target:r,button:n}=e;if(!n||0===n){if(t.onClicBodyDown&&t.onClicBodyDown({comid:t.comid,ev:e}),lt){const t=lt.getTotalDragResizeContext();Object.keys(t).forEach((e=>{a!==e&&t[e].setActive(!1)})),Y(!0)}else dt(!0);R(!0),t.dragHandle&&r.getAttribute("data-drag-handle")!==a.toString()||t.dragCancel&&r.getAttribute("data-drag-cancel")===a.toString()||(void 0!==e.stopPropagation&&e.stopPropagation(),t.isDraggable&&p(!0),Mt({pointerX:void 0!==e.pageX?e.pageX:e.touches[0].pageX,pointerY:void 0!==e.pageY?e.pageY:e.touches[0].pageY}),t.parentLimitation&&k({left:{min:0,max:L-ut},right:{min:0,max:L-ut},top:{min:0,max:B-mt},bottom:{min:0,max:B-mt}}))}}function bt(e){if(!m.current&&!x.current)return;e.stopPropagation();const r=void 0!==e.pageX?e.pageX:e.touches[0].pageX,n=void 0!==e.pageY?e.pageY:e.touches[0].pageY,o={x:(v.current.pointerX-r)/t.parentScaleX,y:(v.current.pointerY-n)/t.parentScaleY};if(m.current&&xt(o),x.current){if("x"===t.axis)o.y=0;else if("y"===t.axis)o.x=0;else if("none"===t.axis)return;yt(o)}}function xt(e){const{snapToGrid:r,gridY:n,gridX:o}=t;let i=v.current.top,c=v.current.bottom,l=v.current.left,a=v.current.right;switch(C.current[0]){case"b":c=v.current.bottom+e.y,r&&(c=B-Math.round((B-c)/n)*n);break;case"t":i=v.current.top-e.y,r&&(i=Math.round(i/n)*n)}switch(C.current[1]){case"r":a=v.current.right+e.x,r&&(a=L-Math.round((L-a)/o)*o);break;case"l":l=v.current.left-e.x,r&&(l=Math.round(l/o)*o)}({newLeft:l,newRight:a,newTop:i,newBottom:c}=vt({newLeft:l,newRight:a,newTop:i,newBottom:c})),t.aspectRatio&&({newLeft:l,newRight:a,newTop:i,newBottom:c}=function(t){let{newLeft:e,newRight:r,newTop:n,newBottom:o}=t,i=L-e-r,c=B-n-o;if("m"===C.current[1]){const t=c-v.current.height;e-=t*w/2,r-=t*w/2}else if("m"===C.current[0]){const t=i-v.current.width;n-=t/w/2,o-=t/w/2}else i/c>w?(i=w*c,"l"===C.current[1]?e=L-r-i:r=L-e-i):(c=i/w,"t"===C.current[0]?n=B-o-c:o=B-n-c);return{newLeft:e,newRight:r,newTop:n,newBottom:o}}({newLeft:l,newRight:a,newTop:i,newBottom:c})),j(l),_(a),q(i),Q(c);const s=L-l-a,u=B-i-c;t.onResizing&&t.onResizing({comid:t.comid,beforeMove:v.current,curMove:{top:i,left:l,right:a,bottom:c,width:s,height:u}})}function yt(e){const{gridX:r,gridY:n,snapToGrid:o}=t;let i=v.current.top-e.y,c=v.current.bottom+e.y,l=v.current.left-e.x,a=v.current.right+e.x;if(o){let t=!0,e=!0,o=i-Math.floor(i/n)*n,s=B-c-Math.floor((B-c)/n)*n,u=l-Math.floor(l/r)*r,m=L-a-Math.floor((L-a)/r)*r;o>n/2&&(o-=n),s>n/2&&(s-=n),u>r/2&&(u-=r),m>r/2&&(m-=r),Math.abs(s)<Math.abs(o)&&(t=!1),Math.abs(m)<Math.abs(u)&&(e=!1),i-=t?o:s,c=B-mt-i,l-=e?u:m,a=L-ut-l}({newLeft:l,newRight:a,newTop:i,newBottom:c}=vt({newLeft:l,newRight:a,newTop:i,newBottom:c})),j(l),_(a),q(i),Q(c),t.onDragging&&t.onDragging({comid:t.comid,beforeMove:v.current,curMove:{top:i,left:l,right:a,bottom:c}})}function vt(t){let{newRight:e,newLeft:r,newBottom:n,newTop:o}=t;return r=wt(D.left,r),e=wt(D.right,e),o=wt(D.top,o),n=wt(D.bottom,n),{newLeft:r,newRight:e,newTop:o,newBottom:n}}function wt(t,e){let r=e;return null!==t.min&&e<t.min?r=t.min:null!==t.max&&t.max<e&&(r=t.max),r}function St(t){if(m.current||x.current){const t=ct({top:W,left:I,width:ut,height:mt});"on"===t.type&&!0===t.isConflict?ot({top:v.current.top,left:v.current.left,right:v.current.right,bottom:v.current.bottom}):(Z({top:W,left:I,right:G,bottom:J}),V({dimensionsBeforeMoveData:v.current})),m.current?Dt():x.current&&kt()}}function Dt(){u(!1),R(!1),t.onResizing&&t.onResizing({comid:t.comid,beforeMove:v.current,curMove:{top:$.current,left:K.current,right:F.current,bottom:U.current,width:L-K.current-F.current,height:B-$.current-U.current}}),t.onResizestop&&t.onResizestop({comid:t.comid,beforeMove:v.current,curMove:{top:$.current,left:K.current,right:F.current,bottom:U.current,width:L-K.current-F.current,height:B-$.current-U.current}}),y({pointerX:0,pointerY:0,left:0,right:0,top:0,bottom:0,width:0,heihgt:0}),k({left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}})}function kt(){p(!1),R(!1),t.onDragging&&t.onDragging({comid:t.comid,beforeMove:v.current,curMove:{top:W,left:I,right:G,bottom:J}}),t.onDragstop&&t.onDragstop({comid:t.comid,beforeMove:v.current,curMove:{top:W,left:I,right:G,bottom:J}}),y({pointerX:0,pointerY:0,left:0,right:0,top:0,bottom:0,width:0,heihgt:0}),k({left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}})}function Mt({pointerX:t,pointerY:e}){y({pointerX:t,pointerY:e,left:I,right:G,top:W,bottom:J,width:ut,height:mt}),S(ut/mt)}return n().createElement(f,{id:t.id,"data-testid":"testid-drag-resize",ref:l,className:i()(["rdr",t.className,X?"active":"inactive",t.class?t.class:"",M?"Operation":""]),onMouseDown:t=>{ht(t)},onTouchStart:t=>{ht(t)},onTouchEnd:t=>{St()},style:{...st,...t.style}},n().createElement("div",{style:pt,className:"content-container",ref:o},t.children),t.sticks.filter((t=>!!["tl","tm","tr","mr","br","bm","bl","ml"].includes(t))).map((e=>n().createElement("div",{key:e,className:i()([t.classNameStick,"rdr-stick",`rdr-stick-${e}`,t.isResizable?"":"not-resizable"]),onMouseDown:t=>{gt(e,t)},onTouchStart:t=>{gt(e,t)},style:at(e)},t.stickSlot[e]))))})));x.defaultProps={comid:void 0,stickSize:8,parentScaleX:1,parentScaleY:1,isActive:void 0,isDraggable:!0,isResizable:!0,aspectRatio:!1,parentLimitation:!1,snapToGrid:!1,gridX:50,gridY:50,parentW:void 0,parentH:void 0,w:200,h:200,minw:0,minh:0,maxw:null,maxh:null,x:0,y:0,z:"auto",dragHandle:void 0,dragCancel:void 0,sticks:["tl","tm","tr","mr","br","bm","bl","ml"],classNameStick:null,stickSlot:{},axis:"both",class:"",isConflictCheck:!1,onClicBodyDown:void 0,onDeselect:null,historyStepsLength:0,onDragging:void 0,onDragstop:null,onResizing:null,onResizestop:null,directionStep:1,shiftDirectionStep:10,keyDirection:null},x.Group=m;const y=x;return e})()));
//# sourceMappingURL=index.js.map
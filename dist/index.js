!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(self,(()=>(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>y});const n=require("react");var r=t.n(n);const o=require("classnames");var i=t.n(o);const c=({register:t,directionStep:e,shiftDirectionStep:r,keyDownDirectionHandel:o})=>{const i=({direction:t,step:e,altKey:n,curPosition:r})=>{let o=r.left,i=r.right,c=r.top,l=r.bottom;return"left"===t?(n||(o-=e),i+=e):"top"===t?(n||(c-=e),l+=e):"right"===t?n?i-=e:(i-=e,o+=e):"bottom"===t&&(n?l-=e:(l-=e,c+=e)),{top:c,left:o,right:i,bottom:l}},c=t=>{const n=t.keyCode||t.which||t.charCode;if(![37,38,39,40].includes(n))return;const c=t.shiftKey,l=t.altKey;let a=e,s=null;c&&(a=r),37===n?(s="left",t.preventDefault()):38===n?(s="top",t.preventDefault()):39===n?(s="right",t.preventDefault()):40===n&&(s="bottom",t.preventDefault()),o&&o({direction:s,step:a,altKey:l,getNewPosition:i})};(0,n.useEffect)((()=>{if(t)return console.log("我从新绑定了"),document.addEventListener("keydown",c),()=>{document.removeEventListener("keydown",c)}}),[e,r,o])},l=require("prop-types");var a=t.n(l);const s=(0,n.createContext)(),u=(0,n.memo)((t=>{const e=(0,n.useRef)({Items:{}});return(0,n.useEffect)((()=>{if(null!==t.defaultActive){const n=Object.values(e.current.Items);for(let e=0;e<n.length;e++){const r=n[e];if(r.comid===t.defaultActive)return void r.setActive(!0)}}}),[]),c({register:null!==t.keyDirection,directionStep:t.directionStep,shiftDirectionStep:t.shiftDirectionStep,keyDownDirectionHandel:({direction:n,step:r,altKey:o,getNewPosition:i})=>{const c=Object.values(e.current.Items);for(let e=0;e<c.length;e++){const l=c[e];let a=null;if("boolean"==typeof t.keyDirection&&!0===t.keyDirection&&(a=!0===l.activeSync.current),"string"==typeof t.keyDirection&&(a=l.comid===t.keyDirection),a){const{top:t,left:e,right:c,bottom:a}=l.getCurPosition(),{top:s,left:u,right:m,bottom:p}=i({direction:n,step:r,altKey:o,curPosition:{top:t,left:e,right:c,bottom:a}});return void l.setPosition({top:s,left:u,right:m,bottom:p})}}}}),r().createElement(s.Provider,{value:{getDragResizeContext:t=>e.current.Items[t],getTotalDragResizeContext:()=>e.current.Items,registerDragResize:(t,n)=>{if(t){const{Items:r}={...e.current};r[t]=n,e.current={...e.current,Items:r}}},unregisterDragResize:t=>{const{Items:n}={...e.current};delete n[t],e.current={...e.current,Items:n}}}},(null==t?void 0:t.children)||"")}));u.propTypes={defaultActive:a().string,keyDirection:(0,l.oneOfType)([a().string,a().bool,a().array]),directionStep:a().number,shiftDirectionStep:a().number},u.defaultProps={defaultActive:null,keyDirection:null,directionStep:1,shiftDirectionStep:10};const m=u,p=require("styled-components"),f=t.n(p)().div`
  &.rdr {
    position: absolute;
    box-sizing: border-box;
    &.active:before {
      content: '';
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      box-sizing: border-box;
      outline: 1px dashed #d6d6d6;
    }
    &.inactive .rdr-stick {
      display: none;
    }
  }
  .rdr-stick {
    box-sizing: border-box;
    position: absolute;
    font-size: 1px;
    background: #ffffff;
    border: 1px solid #6c6c6c;
    box-shadow: 0 0 2px #bbb;
  }
  .rdr-stick-tl,
  .rdr-stick-br {
    cursor: nwse-resize;
  }
  .rdr-stick-tm,
  .rdr-stick-bm {
    left: 50%;
    cursor: ns-resize;
  }
  .rdr-stick-tr,
  .rdr-stick-bl {
    cursor: nesw-resize;
  }
  .rdr-stick-ml,
  .rdr-stick-mr {
    top: 50%;
    cursor: ew-resize;
  }
  .rdr-stick.not-resizable {
    display: none;
  }
  .content-container {
    display: block;
    position: relative;
  }
`,d=(t,e=!0)=>{let r=null,o=null;const i=(0,n.useRef)(t);if(e){const[e,i]=(0,n.useState)(t);r=e,o=i}return[r,t=>{e&&o(t),i.current=t},i]},g=(t,e,r={immediate:!1})=>{const o=(0,n.useRef)(),i=(0,n.useRef)(!1);(0,n.useEffect)((()=>{i.current?e(t,o.current):(i.current=!0,r.immediate&&e(t,o.current)),o.current=t}),[t])},h={t:"top",m:"marginTop",b:"bottom"},b={l:"left",m:"marginLeft",r:"right"},x=(0,n.memo)((0,n.forwardRef)(((t,e)=>{const o=(0,n.useRef)(),l=(0,n.useRef)(),[,,a]=d(Math.random().toString(36).substr(3,10)),[,u,m]=d(!1,!1),[,p,x]=d(!1,!1),[,y,w]=d({pointerX:0,pointerY:0,left:0,right:0,top:0,bottom:0,width:0,heihgt:0},!1),[v,S]=(0,n.useState)(1),[D,k]=(0,n.useState)({left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}}),[M,R]=d(null),[,z,C]=d(null,!1),[X,Y,E]=d(null),[T,P]=(0,n.useState)(null),[L,A,H]=d(null),[B,N,O]=d(null),[I,j,K]=d(null),[W,q,$]=d(null),[G,_,F]=d(null),[J,Q,U]=d(null),{recordHistorySteps:V,recordCurrentSteps:Z,getHistorySteps:tt,historyStepsSync:et,setCurStep:nt,curStepSync:rt}=(t=>{const[,,e]=d([],!1),[,n,r]=d(0,!1),[,o,i]=d(null,!1);return{recordHistorySteps:({dimensionsBeforeMoveData:o})=>{if(r.current<0){const t=e.current.length+r.current;e.current.splice(t),n(0)}t>0&&(e.current.length===t&&e.current.splice(0,1),e.current.push(o))},recordCurrentSteps:t=>{o(t)},getHistorySteps:t=>{if(0===t)return i.current;const n=e.current.length+t;return n>-1?e.current[n]:null},setCurStep:n,curStepSync:r,historyStepsSync:e}})(t.historyStepsLength),ot=({top:e,left:n,right:r,bottom:o})=>{O.current-o-e<=1||H.current-r-n<=1||!0===t.parentLimitation&&(e<0||n<0||r<0||o<0)||(q(e),j(n),_(r),Q(o))},it=t=>{const e=tt(t);return null!==e?(ot({top:e.top,left:e.left,right:e.right,bottom:e.bottom}),nt(t),{status:"success"}):{status:"last"}};(0,n.useImperativeHandle)(e,(()=>({previousOperationStep(){const t=rt.current-1;return it(t)},nextOperationStep(){if(0===rt.current)return{status:"first"};const t=rt.current+1;return it(t)},goOperationStep:t=>it(t),historySteps:et})));const{conflictCheck:ct}=(({isConflictCheck:t,rootRef:e})=>{function r(t){let e=t.replace(/[^0-9\-,]/g,"");return void 0===e&&(e=0),parseFloat(e)}return(0,n.useEffect)((()=>{e.current.setAttribute("data-is-check",`${t}`)}),[]),{conflictCheck:({top:n,left:o,width:i,height:c})=>{if(t){const t=e.current.parentNode.childNodes;for(let e=0;e<t.length;e++){const l=t[e];if(void 0!==l.className&&!l.className.includes("Operation")&&null!==l.getAttribute("data-is-check")&&"false"!==l.getAttribute("data-is-check")){const t=l.offsetWidth,e=l.offsetHeight,a=r(l.style.left),s=r(l.style.top);return n>=s&&o>=a&&s+e>n&&a+t>o||n<=s&&o<a&&n+c>s&&o+i>a||o<=a&&n>=s&&o+i>a&&n<s+e||n<s&&o>a&&n+c>s&&o<a+t||n<=s&&o>=a&&n+c>s&&o<a+t||n>=s&&o<=a&&n<s+e&&o>a+t||n<=s&&o>=a&&n+c>s&&o<a+t||n>=s&&o<=a&&n<s+e&&o>a+t||o>=a&&n>=s&&o<a+t&&n<s+e||n>s&&o<=a&&o+i>a&&n<s+e||n<=s&&o>=a&&n+c>s&&o<a+t||n>=s&&o<=a&&n<s+e&&o+i>a?{type:"on",isConflict:!0}:{type:"on",isConflict:!1}}}return{type:"on",isConflict:!1}}return{type:"off"}}}})({isConflictCheck:t.isConflictCheck,rootRef:l}),lt=(0,n.useContext)(s);c({register:!lt&&!(null===t.keyDirection||!1===t.keyDirection),directionStep:t.directionStep,shiftDirectionStep:t.shiftDirectionStep,keyDownDirectionHandel:({direction:t,step:e,altKey:n,getNewPosition:r})=>{if(!0===E.current){const{top:o,left:i,right:c,bottom:l}=r({direction:t,step:e,altKey:n,curPosition:{top:$.current,left:K.current,right:F.current,bottom:U.current}});ot({top:o,left:i,right:c,bottom:l})}}}),g(t.w,((t,e)=>{if(m.current||x.current||t===ut)return;const n=e-t;gt("mr",{pageX:G,pageY:W+mt/2},!0),xt({x:n,y:0}),Dt()})),g(t.h,((t,e)=>{if(m.current||x.current||t===mt)return;const n=e-t;gt("bm",{pageX:I+ut/2,pageY:J},!0),xt({x:0,y:n}),Dt()})),g(t.y,((t,e)=>{if(m.current||x.current||t===W)return;const n=e-t;ht({pageX:I,pageY:W}),yt({x:0,y:n}),kt()})),g(t.x,((t,e)=>{if(m.current||x.current||t===I)return;const n=e-t;ht({pageX:I,pageY:W}),yt({x:n,y:0}),kt()})),g(t.z,(t=>{(t>=0||"auto"===t)&&P(t)}),{immediate:!0}),g(t.isActive,(t=>{lt||Y(t)}),{immediate:!0}),g(t.parentW,(t=>{_(t-ut-I),A(t)})),g(t.parentH,(t=>{Q(t-mt-W),N(t)})),(0,n.useEffect)((()=>{const e=l.current.parentNode,n=t.parentW?t.parentW:e.clientWidth,r=t.parentH?t.parentH:e.clientHeight,o=t.x,i=t.y;A(n),N(r),j(o),q(i),_(n-("auto"===t.w?e.scrollWidth:t.w)-o),Q(r-("auto"===t.h?e.scrollHeight:t.h)-i),t.dragHandle&&[...e.querySelectorAll(t.dragHandle)].forEach((t=>{t.setAttribute("data-drag-handle",a)})),t.dragCancel&&[...e.querySelectorAll(t.dragCancel)].forEach((t=>{t.setAttribute("data-drag-cancel",a)}))}),[]),(0,n.useEffect)((()=>(null==lt||lt.registerDragResize(a.current,{setActive:Y,activeSync:E,comid:t.comid,getCurPosition:()=>({left:K.current,right:F.current,top:$.current,bottom:U.current}),setPosition:ot}),()=>{null==lt||lt.unregisterDragResize(a.current)})),[]),(0,n.useEffect)((()=>{const t=new Map([["mousemove",bt],["mouseup",St],["mouseleave",St],["mousedown",ft],["touchmove",bt],["touchend",St],["touchcancel",St],["touchstart",St]]);return t.forEach(((t,e)=>{document.documentElement.addEventListener(e,t)})),()=>{t.forEach(((t,e)=>{document.documentElement.removeEventListener(e,t)}))}}),[bt,St,ft]);const at=(0,n.useCallback)((e=>{const{stickSize:n,parentScaleX:r,parentScaleY:o}=t,i={width:n/r+"px",height:n/o+"px"};return i[h[e[0]]]=n/r/-2+"px",i[b[e[1]]]=n/r/-2+"px",i}),[t.stickSize,t.parentScaleX,t.parentScaleY]),st=(0,n.useMemo)((()=>({top:`${W}px`,left:`${I}px`,zIndex:T})),[W,I,T]),ut=(0,n.useMemo)((()=>L-I-G),[L,I,G]),mt=(0,n.useMemo)((()=>B-W-J),[L,W,J]),pt=(0,n.useMemo)((()=>({width:"auto"===t.w.toString()?"auto":`${ut}px`,height:"auto"===t.h.toString()?"auto":`${mt}px`})),[t.w,t.h,ut,mt]);function ft(e){t.onDeselect&&t.onDeselect({comid:t.comid,ev:e}),dt(!1)}function dt(e){null===t.isActive&&Y(e)}function gt(e,n,r=!1){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault(),(t.isResizable&&E.current||r)&&(u(!0),R(!0),Mt({pointerX:void 0!==n.pageX?n.pageX:n.touches[0].pageX,pointerY:void 0!==n.pageY?n.pageY:n.touches[0].pageY}),z(e),k(function(){let e=t.minh,n=t.minw,r=t.maxh,o=t.maxw;t.aspectRatio&&(n/e>v?e=n/v:n=v*e,null!==o?null===r?r=o*v:o/r>v?o=r/v:r=o*v:null!==r&&(o=r/v));let i=null,c=null,l=null,a=null;null!==o&&(i=I-(o-ut),c=G-(o-ut)),null!==r&&(l=W-(r-mt),a=J-(r-mt)),t.parentLimitation&&(i=i<0?0:i,c=c<0?0:c,l=l<0?0:l,a=a<0?0:a);const s={left:{min:i,max:I+(ut-n)},right:{min:c,max:G+(ut-n)},top:{min:l,max:W+(mt-e)},bottom:{min:a,max:J+(mt-e)}};if(t.aspectRatio){const t={left:{min:I-Math.min(W,J)*v*2,max:I+(mt-e)/2*v*2},right:{min:G-Math.min(W,J)*v*2,max:G+(mt-e)/2*v*2},top:{min:W-Math.min(I,G)/v*2,max:W+(ut-n)/2/v*2},bottom:{min:J-Math.min(I,G)/v*2,max:J+(ut-n)/2/v*2}};"m"===C.current[0]?(s.left={min:Math.max(s.left.min,t.left.min),max:Math.min(s.left.max,t.left.max)},s.right={min:Math.max(s.right.min,t.right.min),max:Math.min(s.right.max,t.right.max)}):"m"===C.current[1]&&(s.top={min:Math.max(s.top.min,t.top.min),max:Math.min(s.top.max,t.top.max)},s.bottom={min:Math.max(s.bottom.min,t.bottom.min),max:Math.min(s.bottom.max,t.bottom.max)})}return s}()))}function ht(e){const{target:n,button:r}=e;if(!r||0===r){if(t.onClicBodyDown&&t.onClicBodyDown({comid:t.comid,ev:e}),lt){const t=lt.getTotalDragResizeContext();Object.keys(t).forEach((e=>{a!==e&&t[e].setActive(!1)})),Y(!0)}else dt(!0);R(!0),t.dragHandle&&n.getAttribute("data-drag-handle")!==a.toString()||t.dragCancel&&n.getAttribute("data-drag-cancel")===a.toString()||(void 0!==e.stopPropagation&&e.stopPropagation(),t.isDraggable&&p(!0),Mt({pointerX:void 0!==e.pageX?e.pageX:e.touches[0].pageX,pointerY:void 0!==e.pageY?e.pageY:e.touches[0].pageY}),t.parentLimitation&&k({left:{min:0,max:L-ut},right:{min:0,max:L-ut},top:{min:0,max:B-mt},bottom:{min:0,max:B-mt}}))}}function bt(e){if(!m.current&&!x.current)return;e.stopPropagation();const n=void 0!==e.pageX?e.pageX:e.touches[0].pageX,r=void 0!==e.pageY?e.pageY:e.touches[0].pageY,o={x:(w.current.pointerX-n)/t.parentScaleX,y:(w.current.pointerY-r)/t.parentScaleY};if(m.current&&xt(o),x.current){if("x"===t.axis)o.y=0;else if("y"===t.axis)o.x=0;else if("none"===t.axis)return;yt(o)}}function xt(e){const{snapToGrid:n,gridY:r,gridX:o}=t;let i=w.current.top,c=w.current.bottom,l=w.current.left,a=w.current.right;switch(C.current[0]){case"b":c=w.current.bottom+e.y,n&&(c=B-Math.round((B-c)/r)*r);break;case"t":i=w.current.top-e.y,n&&(i=Math.round(i/r)*r)}switch(C.current[1]){case"r":a=w.current.right+e.x,n&&(a=L-Math.round((L-a)/o)*o);break;case"l":l=w.current.left-e.x,n&&(l=Math.round(l/o)*o)}({newLeft:l,newRight:a,newTop:i,newBottom:c}=wt({newLeft:l,newRight:a,newTop:i,newBottom:c})),t.aspectRatio&&({newLeft:l,newRight:a,newTop:i,newBottom:c}=function(t){let{newLeft:e,newRight:n,newTop:r,newBottom:o}=t,i=L-e-n,c=B-r-o;if("m"===C.current[1]){const t=c-w.current.height;e-=t*v/2,n-=t*v/2}else if("m"===C.current[0]){const t=i-w.current.width;r-=t/v/2,o-=t/v/2}else i/c>v?(i=v*c,"l"===C.current[1]?e=L-n-i:n=L-e-i):(c=i/v,"t"===C.current[0]?r=B-o-c:o=B-r-c);return{newLeft:e,newRight:n,newTop:r,newBottom:o}}({newLeft:l,newRight:a,newTop:i,newBottom:c})),j(l),_(a),q(i),Q(c),t.onResizing&&t.onResizing({comid:t.comid,beforeMove:w.current,curMove:{top:i,left:l,right:a,bottom:c}})}function yt(e){const{gridX:n,gridY:r,snapToGrid:o}=t;let i=w.current.top-e.y,c=w.current.bottom+e.y,l=w.current.left-e.x,a=w.current.right+e.x;if(o){let t=!0,e=!0,o=i-Math.floor(i/r)*r,s=B-c-Math.floor((B-c)/r)*r,u=l-Math.floor(l/n)*n,m=L-a-Math.floor((L-a)/n)*n;o>r/2&&(o-=r),s>r/2&&(s-=r),u>n/2&&(u-=n),m>n/2&&(m-=n),Math.abs(s)<Math.abs(o)&&(t=!1),Math.abs(m)<Math.abs(u)&&(e=!1),i-=t?o:s,c=B-mt-i,l-=e?u:m,a=L-ut-l}({newLeft:l,newRight:a,newTop:i,newBottom:c}=wt({newLeft:l,newRight:a,newTop:i,newBottom:c})),j(l),_(a),q(i),Q(c),t.onDragging&&t.onDragging({comid:t.comid,beforeMove:w.current,curMove:{top:i,left:l,right:a,bottom:c}})}function wt(t){let{newRight:e,newLeft:n,newBottom:r,newTop:o}=t;return n=vt(D.left,n),e=vt(D.right,e),o=vt(D.top,o),r=vt(D.bottom,r),{newLeft:n,newRight:e,newTop:o,newBottom:r}}function vt(t,e){let n=e;return null!==t.min&&e<t.min?n=t.min:null!==t.max&&t.max<e&&(n=t.max),n}function St(t){if(m.current||x.current){const t=ct({top:W,left:I,width:ut,height:mt});"on"===t.type&&!0===t.isConflict?ot({top:w.current.top,left:w.current.left,right:w.current.right,bottom:w.current.bottom}):(Z({top:W,left:I,right:G,bottom:J}),V({dimensionsBeforeMoveData:w.current})),m.current?Dt():x.current&&kt()}}function Dt(){u(!1),R(!1),t.onResizing&&t.onResizing({comid:t.comid,beforeMove:w.current,curMove:{top:W,left:W,right:W,bottom:W}}),t.onResizestop&&t.onResizestop({comid:t.comid,beforeMove:w.current,curMove:{top:W,left:W,right:W,bottom:W}}),y({pointerX:0,pointerY:0,left:0,right:0,top:0,bottom:0,width:0,heihgt:0}),k({left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}})}function kt(){p(!1),R(!1),t.onDragging&&t.onDragging({comid:t.comid,beforeMove:w.current,curMove:{top:W,left:I,right:G,bottom:J}}),t.onDragstop&&t.onDragstop({comid:t.comid,beforeMove:w.current,curMove:{top:W,left:I,right:G,bottom:J}}),y({pointerX:0,pointerY:0,left:0,right:0,top:0,bottom:0,width:0,heihgt:0}),k({left:{min:null,max:null},right:{min:null,max:null},top:{min:null,max:null},bottom:{min:null,max:null}})}function Mt({pointerX:t,pointerY:e}){y({pointerX:t,pointerY:e,left:I,right:G,top:W,bottom:J,width:ut,height:mt}),S(ut/mt)}return r().createElement(f,{id:t.id,"data-testid":"testid-drag-resize",ref:l,className:i()(["rdr",t.className,X?"active":"inactive",t.class?t.class:"",M?"Operation":""]),onMouseDown:t=>{ht(t)},onTouchStart:t=>{ht(t)},onTouchEnd:t=>{St()},style:{...st,...t.style}},r().createElement("div",{style:pt,className:"content-container",ref:o},t.children),t.sticks.filter((t=>!!["tl","tm","tr","mr","br","bm","bl","ml"].includes(t))).map((e=>r().createElement("div",{key:e,className:i()([t.classNameStick,"rdr-stick",`rdr-stick-${e}`,t.isResizable?"":"not-resizable"]),onMouseDown:t=>{gt(e,t)},onTouchStart:t=>{gt(e,t)},style:at(e)},t.stickSlot[e]))))})));x.defaultProps={comid:null,stickSize:8,parentScaleX:1,parentScaleY:1,isActive:null,isDraggable:!0,isResizable:!0,aspectRatio:!1,parentLimitation:!1,snapToGrid:!1,gridX:50,gridY:50,parentW:null,parentH:null,w:200,h:200,minw:0,minh:0,maxw:null,maxh:null,x:0,y:0,z:"auto",dragHandle:null,dragCancel:null,sticks:["tl","tm","tr","mr","br","bm","bl","ml"],classNameStick:null,stickSlot:{},axis:"both",class:"",isConflictCheck:!1,onClicBodyDown:null,onDeselect:null,historyStepsLength:0,onDragging:null,onDragstop:null,onResizing:null,onResizestop:null,directionStep:1,shiftDirectionStep:10,keyDirection:null},x.Group=m;const y=x;return e})()));
//# sourceMappingURL=index.js.map